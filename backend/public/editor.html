<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线代码编辑器 (Ace Editor + iframe)</title>
    <style>
        /* --- 基本样式重置与布局 --- */
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow-x: auto;
        }

        /* --- 主容器：使用Flexbox创建左右布局 --- */
        .container {
            display: flex;
            height: 100%;
        }

        /* --- 左右两个面板的通用样式 --- */
        .pane1,
        .pane2 {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .pane1 {
            width: 50%;
            min-width: 400px;
            max-width: 800px;
            padding-top: 20px;
        }

        .pane2 {
            flex-grow: 1;
            min-width: 800px;
        }

        /* --- 编辑器面板 --- */
        .editor-pane {
            background-color: #03030c;
        }

        #editor {
            width: 100%;
            flex-grow: 1;
            font-size: 16px;
        }

        /* Ace Editor 的光标有时会因布局问题错位，以下样式可修复 */
        #editor .ace_gutter {
            z-index: 1;
        }

        /* --- 控制栏 --- */
        .controls {
            padding: 6px 15px;
            border-top: 1px solid #000000;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        #run-button {
            width: 100%;
            padding: 8px 20px;
            background-color: #226224;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        #run-button:hover {
            background-color: #1a9020;
        }

        .preview-pane {
            border-left: 2px solid #ccc;
            background-color: #fff;
        }

        #preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            background-color: #fff;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;

        }

        ::-webkit-scrollbar-thumb {
            background: #2e9ae392;

        }

        ::-webkit-scrollbar-thumb:hover {
            background: #0064a2ee;
        }

        .ace-monokai {
            background-color: #121211;
        }

        .ace-monokai .ace_gutter {
            background-color: #03030c;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="pane1 editor-pane">
            <div id="editor"></div>
            <div class="controls">
                <button id="run-button">预览 (Run)</button>
            </div>
        </div>

        <div class="pane2 preview-pane">
            <iframe id="preview-frame" title="代码预览"></iframe>
        </div>
    </div>

    <!-- 引入 Ace Editor 核心库和扩展 -->
    <!-- 核心库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
    <!-- 语言工具扩展，用于自动补全 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ext-language_tools.js"></script>

    <script>
        // 1. 初始化 Ace Editor
        // -----------------------------------------------------------------
        const editor = ace.edit("editor");

        // 设置主题 (例如：monokai, chrome, github, solarized_dark)
        editor.setTheme("ace/theme/monokai");

        // 设置语言模式为 HTML (也支持 css, javascript)
        editor.session.setMode("ace/mode/html");

        // 设置编辑器选项
        editor.setOptions({
            fontSize: "14px",                 // 字体大小
            enableBasicAutocompletion: true,  // 启用基本自动补全
            enableLiveAutocompletion: true,   // 启用实时自动补全 (需要 ext-language_tools.js)
            enableSnippets: true,             // 启用代码片段
            showPrintMargin: false,           // 不显示打印边距线
            wrap: true,                       // 自动换行
        });


        // 2. 设置编辑器初始代码内容
        const savedCode = localStorage.getItem('htmlcode');

        // 如果 localStorage 中有保存的代码，则使用它；否则使用一个默认的空字符串。
        const initialCode = savedCode || '';

        // 将初始代码设置到编辑器中，-1表示光标不移动到末尾
        editor.setValue(initialCode, -1);


        // 3. 实现预览功能
        // -----------------------------------------------------------------
        const runButton = document.getElementById('run-button');
        const previewFrame = document.getElementById('preview-frame');

        // 更新预览区域的函数
        function updatePreview() {
            // 从 Ace Editor 获取当前全部代码
            const code = editor.getValue();
            localStorage.setItem('htmlcode', code);

            // 将代码内容赋值给 iframe 的 srcdoc 属性
            // 这是最安全、最直接的渲染方式，可以有效隔离主页面和预览页面的环境
            previewFrame.srcdoc = code;
        }

        // 为“运行”按钮添加点击事件监听
        runButton.addEventListener('click', updatePreview);

        if (savedCode) {
            runButton.click();
        }
    </script>
</body>

</html>